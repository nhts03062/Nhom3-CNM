<div class="row">
  <!-- Header Section -->
  <div class="header">
    <!-- Search Bar and Add Friend Button -->
    <div class="search">
      <div class="searchbar">
        <i class="fa fa-search" aria-hidden="true"></i>
        <input type="text" placeholder="Search..." [(ngModel)]="searchTerm" />
      </div>
      <button class="add-friend" (click)="toggleModal()">
        <i class="fa-solid fa-user-plus create clickable"></i>
      </button>
      <app-modal [isOpen]="showModal" (closeModal)="toggleModal()" title="Add Friend"></app-modal>
    </div>
    
    <!-- Header Chat Title -->
    <div class="header-chat">
      <p>{{ tabTitles[selectedTab] }}</p>
      <i class="icon clickable fa fa-ellipsis-h right" aria-hidden="true"></i>
    </div>
  </div>

  <!-- Tabs Navigation -->
  <section class="Left-section">
    <div class="left-section" [class.active]="selectedTab === 0" (click)="onSelectTab(0)">
      <p>Friends List</p>
    </div>
    <div class="left-section" [class.active]="selectedTab === 1" (click)="onSelectTab(1)">
      <p>Group List</p>
    </div>
    <div class="left-section" [class.active]="selectedTab === 2" (click)="onSelectTab(2)">
      <p>Requests</p>
    </div>
  </section>

  <!-- Tab Content -->
  <section class="Right-section">
    <!-- Friends Tab -->
    <div *ngIf="selectedTab === 0">
      <h6 class="friend-count">Friends ({{ filteredFriends.length }})</h6>
      <ng-container *ngFor="let friend of filteredFriends">
        <div 
          class="left-section friends" 
          [class.active]="selectedFriend?._id === friend._id"
          (click)="selectFriend(friend)">
          <div class="photo" [style.backgroundImage]="'url(' + (friend.avatarUrl || defaultAvatarUrl) + ')'"></div>
          <div class="desc-contact">
            <div class="username">
              <p class="name">{{ friend.name }}</p>
            </div>
          </div>
        </div>
      </ng-container>
      <div class="no-results" *ngIf="searchTerm && filteredFriends.length === 0">
        No friends found.
      </div>
    </div>

    <!-- Group Tab -->
    <div *ngIf="selectedTab === 1">
      <p>Coming soon: Group list feature!</p>
      <!-- Uncomment and implement filteredGroups when group data is available -->
    </div>

    <!-- Requests Tab -->
    <div *ngIf="selectedTab === 2" class="request-container">
      <!-- Received Requests -->
      <ng-container *ngFor="let receivedRequest of user?.friendRequestsReceived">
        <div class="card mb-3" *ngIf="receivedRequest">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="photo me-3"
                [style.backgroundImage]="'url(' + (getUserById(receivedRequest)?.avatarUrl || defaultAvatarUrl) + ')'">
              </div>
              <div>
                <h5 class="card-title mb-1">
                  Friend request from {{ getUserById(receivedRequest)?.name || 'Unknown' }}
                </h5>
                <p class="text-muted mb-2">{{ getUserById(receivedRequest)?.createdAt }}</p>
              </div>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-outline-danger btn-sm" (click)="handleFriendRequestResponse('0', receivedRequest)">Decline</button>
      <button class="btn btn-outline-success btn-sm" (click)="handleFriendRequestResponse('1', receivedRequest)">Accept</button>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Sent Requests -->
      <ng-container *ngFor="let sentRequest of user?.requestfriends">
        <div class="card mb-3" *ngIf="sentRequest">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="photo me-3"
                [style.backgroundImage]="'url(' + (getUserById(sentRequest)?.avatarUrl || defaultAvatarUrl) + ')'">
              </div>
              <div>
                <h5 class="card-title mb-1">
                  Sent request to {{ getUserById(sentRequest)?.name || 'Unknown' }}
                </h5>
                <p class="text-muted mb-2">{{ getUserById(sentRequest)?.createdAt }}</p>
              </div>
            </div>
            <div class="d-flex gap-2 mt-3">
              <!-- Cancel Sent Request Button -->
              <!-- <button class="btn btn-outline-danger btn-sm" (click)="requestResponse('0')">Cancel</button> -->
              <!-- Pending Button -->
              <button disabled class="btn btn-outline-success btn-sm">Pending</button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </section>
</div>

<!-- Profile Modal -->
<app-modal-profile 
  [isOpen]="showProfileModal"
  [user]="selectedFriend"
  (closeModal)="toggleProfileModal()"
  title="Profile">
</app-modal-profile>